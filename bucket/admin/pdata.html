<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sharm El Sheikh Admin Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Playfair+Display:wght@700;800&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-storage-compat.js"></script>

    <style type="text/css">
        :root {
            --bg-dark: #212121;
            --bg-darker: #1a1a1a;
            --bg-light: #2d2d2d;
            --primary: #f59e0b;
            --primary-hover: #d97706;
            --text-primary: #f3f4f6;
            --text-secondary: #9ca3af;
        }
        
        body {
            background-color: var(--bg-dark);
            color: var(--text-primary);
            font-family: 'Poppins', sans-serif;
        }
        
        .sharm-admin-sidebar {
            width: 280px;
            background-color: var(--bg-darker);
            transition: all 0.3s ease;
            border-right: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .sharm-admin-content {
            margin-left: 280px;
            transition: all 0.3s ease;
            background-color: var(--bg-dark);
        }
        
        .sharm-admin-collapsed .sharm-admin-sidebar {
            width: 80px;
        }
        
        .sharm-admin-collapsed .sharm-admin-content {
            margin-left: 80px;
        }
        
        .sharm-admin-nav-item {
            transition: all 0.3s ease;
            color: var(--text-secondary);
        }
        
        .sharm-admin-nav-item:hover {
            background-color: rgba(245, 158, 11, 0.1);
            color: var(--text-primary);
        }
        
        .sharm-admin-nav-item.active {
            background-color: rgba(245, 158, 11, 0.2);
            border-left: 4px solid var(--primary);
            color: var(--text-primary);
        }
        
        .sharm-admin-table {
            background-color: var(--bg-light);
            color: var(--text-primary);
        }
        
        .sharm-admin-table th {
            background-color: var(--bg-darker);
            color: var(--text-primary);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .sharm-admin-table tr {
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .sharm-admin-table tr:hover {
            background-color: rgba(255, 255, 255, 0.03);
        }
        
        .sharm-admin-map-container {
            height: 300px;
            width: 100%;
            border-radius: 8px;
            overflow: hidden;
            background-color: var(--bg-light);
        }
        
        .sharm-admin-image-preview {
            height: 150px;
            width: 100%;
            object-fit: cover;
            border-radius: 8px;
            background-color: var(--bg-light);
        }
        
        .sharm-admin-logo-preview {
            height: 80px;
            width: 80px;
            object-fit: cover;
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }
        
        .leaflet-container .leaflet-control-attribution {
            display: none !important;
        }
        
        .sharm-admin-tab-content {
            display: none;
        }
        
        .sharm-admin-tab-content.active {
            display: block;
        }
        
        .sharm-admin-tab-btn {
            transition: all 0.3s ease;
        }
        
        .sharm-admin-tab-btn.active {
            background-color: var(--primary);
            color: white;
        }
        
        .sharm-admin-upload-btn {
            position: relative;
            overflow: hidden;
            background-color: var(--bg-light);
            border-color: rgba(255, 255, 255, 0.1);
        }
        
        .sharm-admin-upload-btn:hover {
            border-color: var(--primary);
        }
        
        .sharm-admin-upload-btn input {
            position: absolute;
            top: 0;
            left: 0;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
        
        .sharm-admin-card {
            background-color: var(--bg-light);
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .sharm-admin-icon-bg {
            background-color: rgba(245, 158, 11, 0.1);
        }
        
        /* Mobile responsive styles */
        @media (max-width: 768px) {
            .sharm-admin-sidebar {
                width: 100%;
                position: fixed;
                height: 70px;
                bottom: 0;
                top: auto;
                z-index: 50;
                border-right: none;
                border-top: 1px solid rgba(255, 255, 255, 0.1);
            }
            
            .sharm-admin-content {
                margin-left: 0;
                margin-bottom: 70px;
            }
            
            .sharm-admin-collapsed .sharm-admin-sidebar {
                width: 100%;
            }
            
            .sharm-admin-collapsed .sharm-admin-content {
                margin-left: 0;
            }
            
            .sidebar-nav-items {
                display: flex;
                justify-content: space-around;
                padding: 0;
            }
            
            .sidebar-nav-items li {
                flex: 1;
                text-align: center;
            }
            
            .sharm-admin-nav-item {
                flex-direction: column;
                padding: 10px 5px;
                font-size: 0.7rem;
                border-left: none;
                border-top: 4px solid transparent;
            }
            
            .sharm-admin-nav-item.active {
                border-left: none;
                border-top: 4px solid var(--primary);
            }
            
            .sharm-admin-nav-item i {
                margin-right: 0;
                margin-bottom: 5px;
                font-size: 1.2rem;
            }
            
            .sharm-admin-nav-item span {
                display: block;
            }
            
            .sidebar-header, .sidebar-footer {
                display: none;
            }
            
            .dashboard-cards {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .sharm-admin-table {
                font-size: 0.8rem;
            }
            
            .sharm-admin-table th, 
            .sharm-admin-table td {
                padding: 8px 4px;
            }
        }
    </style>
    
    
    
</head>
<body class="dark">
    <div class="flex h-screen flex-col md:flex-row" id="admin-container">
        <!-- Sidebar -->
        <div class="sharm-admin-sidebar flex flex-col">
            <div class="sidebar-header p-4 border-b border-gray-700 flex items-center justify-between">
                <div class="flex items-center">
                    <img src="https://via.placeholder.com/40" alt="Logo" class="rounded-full h-10 w-10">
                    <span class="ml-3 font-bold text-lg text-amber-400">Sharm Admin</span>
                </div>
                <button id="sidebar-toggle" class="text-gray-400 hover:text-amber-400 md:block hidden">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
            
            <div class="p-4 flex-1 overflow-y-auto md:block hidden">
                <ul class="space-y-2">
                    <li>
                        <a href="#" class="sharm-admin-nav-item active flex items-center p-3 rounded-lg" data-tab="dashboard">
                            <i class="fas fa-tachometer-alt w-6 text-center text-amber-400"></i>
                            <span class="ml-3">Dashboard</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" class="sharm-admin-nav-item flex items-center p-3 rounded-lg" data-tab="restaurants">
                            <i class="fas fa-utensils w-6 text-center text-amber-400"></i>
                            <span class="ml-3">Restaurants</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" class="sharm-admin-nav-item flex items-center p-3 rounded-lg" data-tab="cafes">
                            <i class="fas fa-coffee w-6 text-center text-amber-400"></i>
                            <span class="ml-3">Coffee Shops</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" class="sharm-admin-nav-item flex items-center p-3 rounded-lg" data-tab="beaches">
                            <i class="fas fa-umbrella-beach w-6 text-center text-amber-400"></i>
                            <span class="ml-3">Beaches</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" class="sharm-admin-nav-item flex items-center p-3 rounded-lg" data-tab="discos">
                            <i class="fas fa-moon w-6 text-center text-amber-400"></i>
                            <span class="ml-3">Nightlife</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" class="sharm-admin-nav-item flex items-center p-3 rounded-lg" data-tab="settings">
                            <i class="fas fa-cog w-6 text-center text-amber-400"></i>
                            <span class="ml-3">Settings</span>
                        </a>
                    </li>
                </ul>
            </div>
            
            <!-- Mobile Bottom Navigation -->
            <div class="md:hidden block">
                <ul class="sidebar-nav-items">
                    <li>
                        <a href="#" class="sharm-admin-nav-item active flex flex-col items-center p-2 rounded-lg" data-tab="dashboard">
                            <i class="fas fa-tachometer-alt text-amber-400"></i>
                            <span>Dashboard</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" class="sharm-admin-nav-item flex flex-col items-center p-2 rounded-lg" data-tab="restaurants">
                            <i class="fas fa-utensils text-amber-400"></i>
                            <span>Restaurants</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" class="sharm-admin-nav-item flex flex-col items-center p-2 rounded-lg" data-tab="cafes">
                            <i class="fas fa-coffee text-amber-400"></i>
                            <span>Cafés</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" class="sharm-admin-nav-item flex flex-col items-center p-2 rounded-lg" data-tab="settings">
                            <i class="fas fa-cog text-amber-400"></i>
                            <span>Settings</span>
                        </a>
                    </li>
                </ul>
            </div>
            
            <div class="sidebar-footer p-4 border-t border-gray-700 md:block hidden">
                <div class="flex items-center">
                    <img src="https://via.placeholder.com/40" alt="User" class="rounded-full h-10 w-10">
                    <div class="ml-3">
                        <p class="text-sm font-medium">Admin User</p>
                        <p class="text-xs text-gray-400">Super Admin</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="sharm-admin-content flex-1 overflow-auto">
            <!-- Dashboard Tab -->
            <div id="dashboard-tab" class="sharm-admin-tab-content active p-4 md:p-6">
                <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
                    <h1 class="text-2xl font-bold text-amber-400">Dashboard</h1>
                    <div class="flex items-center space-x-2 md:space-x-4 w-full md:w-auto">
                        <div class="relative flex-1 md:flex-none">
                            <input type="text" placeholder="Search..." class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-amber-400 focus:border-transparent">
                            <i class="fas fa-search absolute right-3 top-3 text-gray-400"></i>
                        </div>
                        <button class="bg-amber-500 hover:bg-amber-600 text-white px-3 py-2 rounded-lg transition-colors whitespace-nowrap">
                            <i class="fas fa-plus mr-1 md:mr-2"></i>
                            <span class="hidden md:inline">Add New</span>
                        </button>
                    </div>
                </div>
                
                <div class="dashboard-cards grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                    <div class="sharm-admin-card p-4 rounded-lg">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-400">Total Restaurants</p>
                                <h3 class="text-2xl font-bold" id="restaurants-count">0</h3>
                                <p class="text-sm text-green-400 flex items-center">
                                    <i class="fas fa-arrow-up mr-1"></i>
                                    <span>12% from last month</span>
                                </p>
                            </div>
                            <div class="sharm-admin-icon-bg p-3 rounded-full">
                                <i class="fas fa-utensils text-amber-500 text-xl"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="sharm-admin-card p-4 rounded-lg">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-400">Total Cafés</p>
                                <h3 class="text-2xl font-bold" id="cafes-count">0</h3>
                                <p class="text-sm text-green-400 flex items-center">
                                    <i class="fas fa-arrow-up mr-1"></i>
                                    <span>8% from last month</span>
                                </p>
                            </div>
                            <div class="sharm-admin-icon-bg p-3 rounded-full">
                                <i class="fas fa-coffee text-amber-500 text-xl"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="sharm-admin-card p-4 rounded-lg">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-400">Total Beaches</p>
                                <h3 class="text-2xl font-bold" id="beaches-count">0</h3>
                                <p class="text-sm text-green-400 flex items-center">
                                    <i class="fas fa-arrow-up mr-1"></i>
                                    <span>5% from last month</span>
                                </p>
                            </div>
                            <div class="sharm-admin-icon-bg p-3 rounded-full">
                                <i class="fas fa-umbrella-beach text-amber-500 text-xl"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="sharm-admin-card p-4 rounded-lg">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-400">Nightlife Venues</p>
                                <h3 class="text-2xl font-bold" id="discos-count">0</h3>
                                <p class="text-sm text-red-400 flex items-center">
                                    <i class="fas fa-arrow-down mr-1"></i>
                                    <span>3% from last month</span>
                                </p>
                            </div>
                            <div class="sharm-admin-icon-bg p-3 rounded-full">
                                <i class="fas fa-moon text-amber-500 text-xl"></i>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="sharm-admin-card p-4 md:p-6 rounded-lg mb-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-bold text-amber-400">Recent Activity</h2>
                        <button class="text-sm text-amber-400 hover:underline">View All</button>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full sharm-admin-table rounded-lg overflow-hidden">
                            <thead>
                                <tr>
                                    <th class="px-4 py-3 text-left text-xs font-medium uppercase tracking-wider">Type</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium uppercase tracking-wider">Name</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium uppercase tracking-wider">Action</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium uppercase tracking-wider">Time</th>
                                </tr>
                            </thead>
                            <tbody id="activity-table">
                                <!-- Activity logs will be inserted here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Restaurants Tab -->
            <div id="restaurants-tab" class="sharm-admin-tab-content p-4 md:p-6">
                <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
                    <h1 class="text-2xl font-bold text-amber-400">Restaurants</h1>
                    <button id="add-restaurant-btn" class="bg-amber-500 hover:bg-amber-600 text-white px-4 py-2 rounded-lg transition-colors whitespace-nowrap">
                        <i class="fas fa-plus mr-2"></i> Add Restaurant
                    </button>
                </div>
                
                <div class="sharm-admin-card p-4 md:p-6 rounded-lg">
                    <div class="overflow-x-auto">
                        <table class="min-w-full sharm-admin-table rounded-lg">
                            <thead>
                                <tr>
                                    <th class="px-4 py-3 text-left text-xs font-medium uppercase tracking-wider">Name</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium uppercase tracking-wider">Type</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium uppercase tracking-wider">Area</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium uppercase tracking-wider">Rating</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium uppercase tracking-wider">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="restaurants-table">
                                <!-- Restaurants will be inserted here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Cafes Tab -->
            <div id="cafes-tab" class="sharm-admin-tab-content p-4 md:p-6">
                <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
                    <h1 class="text-2xl font-bold text-amber-400">Coffee Shops</h1>
                    <button id="add-cafe-btn" class="bg-amber-500 hover:bg-amber-600 text-white px-4 py-2 rounded-lg transition-colors whitespace-nowrap">
                        <i class="fas fa-plus mr-2"></i> Add Coffee Shop
                    </button>
                </div>
                
                <div class="sharm-admin-card p-4 md:p-6 rounded-lg">
                    <div class="overflow-x-auto">
                        <table class="min-w-full sharm-admin-table rounded-lg">
                            <thead>
                                <tr>
                                    <th class="px-4 py-3 text-left text-xs font-medium uppercase tracking-wider">Name</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium uppercase tracking-wider">Type</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium uppercase tracking-wider">Area</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium uppercase tracking-wider">Rating</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium uppercase tracking-wider">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="cafes-table">
                                <!-- Cafes will be inserted here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Beaches Tab -->
            <div id="beaches-tab" class="sharm-admin-tab-content p-4 md:p-6">
                <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
                    <h1 class="text-2xl font-bold text-amber-400">Beaches</h1>
                    <button id="add-beach-btn" class="bg-amber-500 hover:bg-amber-600 text-white px-4 py-2 rounded-lg transition-colors whitespace-nowrap">
                        <i class="fas fa-plus mr-2"></i> Add Beach
                    </button>
                </div>
                
                <div class="sharm-admin-card p-4 md:p-6 rounded-lg">
                    <div class="overflow-x-auto">
                        <table class="min-w-full sharm-admin-table rounded-lg">
                            <thead>
                                <tr>
                                    <th class="px-4 py-3 text-left text-xs font-medium uppercase tracking-wider">Name</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium uppercase tracking-wider">Type</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium uppercase tracking-wider">Area</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium uppercase tracking-wider">Rating</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium uppercase tracking-wider">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="beaches-table">
                                <!-- Beaches will be inserted here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Nightlife Tab -->
            <div id="discos-tab" class="sharm-admin-tab-content p-4 md:p-6">
                <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
                    <h1 class="text-2xl font-bold text-amber-400">Nightlife Venues</h1>
                    <button id="add-disco-btn" class="bg-amber-500 hover:bg-amber-600 text-white px-4 py-2 rounded-lg transition-colors whitespace-nowrap">
                        <i class="fas fa-plus mr-2"></i> Add Venue
                    </button>
                </div>
                
                <div class="sharm-admin-card p-4 md:p-6 rounded-lg">
                    <div class="overflow-x-auto">
                        <table class="min-w-full sharm-admin-table rounded-lg">
                            <thead>
                                <tr>
                                    <th class="px-4 py-3 text-left text-xs font-medium uppercase tracking-wider">Name</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium uppercase tracking-wider">Type</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium uppercase tracking-wider">Area</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium uppercase tracking-wider">Rating</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium uppercase tracking-wider">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="discos-table">
                                <!-- Nightlife venues will be inserted here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Settings Tab -->
            <div id="settings-tab" class="sharm-admin-tab-content p-4 md:p-6">
                <div class="flex justify-between items-center mb-6">
                    <h1 class="text-2xl font-bold text-amber-400">Settings</h1>
                </div>
                
                <div class="sharm-admin-card p-4 md:p-6 rounded-lg">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h2 class="text-xl font-bold mb-4 text-amber-400">General Settings</h2>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium mb-1">App Name</label>
                                    <input type="text" class="w-full bg-gray-700 border border-gray-600 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-amber-400 focus:border-transparent" value="Sharm's Best">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-1">Primary Color</label>
                                    <input type="color" class="w-16 h-10" value="#f59e0b">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-1">Secondary Color</label>
                                    <input type="color" class="w-16 h-10" value="#FFD166">
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <h2 class="text-xl font-bold mb-4 text-amber-400">Admin Preferences</h2>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium mb-1">Notifications</label>
                                    <label class="inline-flex items-center cursor-pointer">
                                        <input type="checkbox" class="sr-only peer" checked>
                                        <div class="relative w-11 h-6 bg-gray-700 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-amber-400 rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-600 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-amber-500"></div>
                                        <span class="ms-3 text-sm">Enable</span>
                                    </label>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-1">Email Alerts</label>
                                    <label class="inline-flex items-center cursor-pointer">
                                        <input type="checkbox" class="sr-only peer">
                                        <div class="relative w-11 h-6 bg-gray-700 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-amber-400 rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-600 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-amber-500"></div>
                                        <span class="ms-3 text-sm">Enable</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-6 flex justify-end">
                        <button class="bg-amber-500 hover:bg-amber-600 text-white px-6 py-2 rounded-lg transition-colors">
                            Save Settings
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add/Edit Modal -->
    <div id="place-modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden px-4">
        <div class="bg-gray-800 rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-amber-400" id="modal-title">Add New Place</h3>
                    <button id="close-modal" class="text-gray-400 hover:text-white">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <form id="place-form" class="space-y-4">
                    <input type="hidden" id="place-id">
                    <input type="hidden" id="place-type">
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="name" class="block text-sm font-medium mb-1">Name *</label>
                            <input type="text" id="name" class="w-full bg-gray-700 border border-gray-600 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-amber-400 focus:border-transparent" required>
                        </div>
                        
                        <div>
                            <label for="type" class="block text-sm font-medium mb-1">Type *</label>
                            <select id="type" class="w-full bg-gray-700 border border-gray-600 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-amber-400 focus:border-transparent" required>
                                <!-- Options will be populated based on place type -->
                            </select>
                        </div>
                        
                        <div>
                            <label for="area" class="block text-sm font-medium mb-1">Area *</label>
                            <select id="area" class="w-full bg-gray-700 border border-gray-600 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-amber-400 focus:border-transparent" required>
                                <option value="naama">Naama Bay</option>
                                <option value="old-market">Old Market</option>
                                <option value="hadaba">El Hadaba</option>
                                <option value="soho">Soho Square</option>
                                <option value="ras-um-sid">Ras Um Sid</option>
                                <option value="sharks-bay">Shark's Bay</option>
                            </select>
                        </div>
                        
                        <div>
                            <label for="rating" class="block text-sm font-medium mb-1">Rating (1-5) *</label>
                            <input type="number" id="rating" min="1" max="5" step="0.1" class="w-full bg-gray-700 border border-gray-600 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-amber-400 focus:border-transparent" required>
                        </div>
                        
                        <div>
                            <label for="reviews" class="block text-sm font-medium mb-1">Number of Reviews</label>
                            <input type="number" id="reviews" min="0" class="w-full bg-gray-700 border border-gray-600 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-amber-400 focus:border-transparent" value="0">
                        </div>
                        
                        <div>
                            <label for="phone" class="block text-sm font-medium mb-1">Phone Number</label>
                            <input type="tel" id="phone" class="w-full bg-gray-700 border border-gray-600 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-amber-400 focus:border-transparent">
                        </div>
                        
                        <div id="hours-container" class="md:col-span-2">
                            <label for="hours" class="block text-sm font-medium mb-1">Opening Hours</label>
                            <input type="text" id="hours" class="w-full bg-gray-700 border border-gray-600 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-amber-400 focus:border-transparent" placeholder="e.g. 9:00 AM - 11:00 PM">
                        </div>
                        
                        <div id="features-container" class="md:col-span-2">
                            <label for="features" class="block text-sm font-medium mb-1">Features</label>
                            <input type="text" id="features" class="w-full bg-gray-700 border border-gray-600 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-amber-400 focus:border-transparent" placeholder="e.g. Private beach, Water sports">
                        </div>
                        
                        <div id="menu-link-container" class="md:col-span-2">
                            <label for="menu-link" class="block text-sm font-medium mb-1">Menu Link</label>
                            <input type="url" id="menu-link" class="w-full bg-gray-700 border border-gray-600 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-amber-400 focus:border-transparent" placeholder="https://example.com/menu">
                        </div>
                        
                        <div id="ticket-link-container" class="md:col-span-2">
                            <label for="ticket-link" class="block text-sm font-medium mb-1">Ticket Link</label>
                            <input type="url" id="ticket-link" class="w-full bg-gray-700 border border-gray-600 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-amber-400 focus:border-transparent" placeholder="https://example.com/tickets">
                        </div>
                        
                        <div class="md:col-span-2">
                            <label for="description" class="block text-sm font-medium mb-1">Description *</label>
                            <textarea id="description" rows="3" class="w-full bg-gray-700 border border-gray-600 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-amber-400 focus:border-transparent" required></textarea>
                        </div>
                        
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium mb-1">Location *</label>
                            <div class="sharm-admin-map-container" id="location-map"></div>
                            <div class="mt-2 grid grid-cols-2 gap-4">
                                <div>
                                    <label for="latitude" class="block text-sm font-medium mb-1">Latitude</label>
                                    <input type="number" id="latitude" step="0.000001" class="w-full bg-gray-700 border border-gray-600 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-amber-400 focus:border-transparent" required>
                                </div>
                                <div>
                                    <label for="longitude" class="block text-sm font-medium mb-1">Longitude</label>
                                    <input type="number" id="longitude" step="0.000001" class="w-full bg-gray-700 border border-gray-600 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-amber-400 focus:border-transparent" required>
                                </div>
                            </div>
                            <p class="text-xs text-gray-400 mt-1">Click on the map to set location coordinates</p>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-1">Main Image *</label>
                            <div class="sharm-admin-upload-btn relative rounded-lg p-4 text-center cursor-pointer border-2 border-dashed">
                                <input type="file" id="main-image" accept="image/*" class="file-input">
                                <div id="main-image-preview-container">
                                    <i class="fas fa-image text-3xl text-gray-400 mb-2"></i>
                                    <p class="text-sm text-gray-400">Click to upload image</p>
                                    <p class="text-xs text-gray-500">Recommended size: 800x600px</p>
                                </div>
                                <img id="main-image-preview" class="sharm-admin-image-preview hidden">
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-1">Logo Image</label>
                            <div class="sharm-admin-upload-btn relative rounded-lg p-4 text-center cursor-pointer border-2 border-dashed">
                                <input type="file" id="logo-image" accept="image/*" class="file-input">
                                <div id="logo-image-preview-container">
                                    <i class="fas fa-image text-3xl text-gray-400 mb-2"></i>
                                    <p class="text-sm text-gray-400">Click to upload logo</p>
                                    <p class="text-xs text-gray-500">Recommended size: 200x200px</p>
                                </div>
                                <img id="logo-image-preview" class="sharm-admin-logo-preview hidden mx-auto">
                            </div>
                        </div>
                    </div>
                    
                    <div class="pt-4 flex justify-end space-x-3">
                        <button type="button" id="cancel-modal" class="px-4 py-2 border border-gray-600 rounded-md text-gray-300 hover:bg-gray-700 transition-colors">
                            Cancel
                        </button>
                        <button type="submit" class="px-4 py-2 bg-amber-500 hover:bg-amber-600 text-white rounded-md transition-colors">
                            Save Place
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Confirmation Modal -->
    <div id="confirm-modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden px-4">
        <div class="bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-md">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-amber-400">Confirm Deletion</h3>
                <button id="close-confirm-modal" class="text-gray-400 hover:text-white">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <p class="mb-6 text-gray-300">Are you sure you want to delete this place? This action cannot be undone.</p>
            
            <div class="flex justify-end space-x-3">
                <button type="button" id="cancel-delete" class="px-4 py-2 border border-gray-600 rounded-md text-gray-300 hover:bg-gray-700 transition-colors">
                    Cancel
                </button>
                <button type="button" id="confirm-delete" class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-md transition-colors">
                    Delete
                </button>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDrkYUXLTCo4SK4TYWbNJfFLUwwOiQFQJI",
            authDomain: "egypt-travels.firebaseapp.com",
            databaseURL: "https://egypt-travels-default-rtdb.firebaseio.com",
            projectId: "egypt-travels",
            storageBucket: "egypt-travels.appspot.com",
            messagingSenderId: "477485386557",
            appId: "1:477485386557:web:755f9649043288db819354",
            measurementId: "G-RKD5F46NM8"
        };
        
        // Initialize Firebase
        const firebaseApp = firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const storage = firebase.storage();
        
        // DOM elements
        const adminContainer = document.getElementById('admin-container');
        const sidebarToggle = document.getElementById('sidebar-toggle');
        const navItems = document.querySelectorAll('.sharm-admin-nav-item');
        const tabContents = document.querySelectorAll('.sharm-admin-tab-content');
        
        // Modal elements
        const placeModal = document.getElementById('place-modal');
        const confirmModal = document.getElementById('confirm-modal');
        const closeModalBtn = document.getElementById('close-modal');
        const closeConfirmModalBtn = document.getElementById('close-confirm-modal');
        const cancelModalBtn = document.getElementById('cancel-modal');
        const cancelDeleteBtn = document.getElementById('cancel-delete');
        const confirmDeleteBtn = document.getElementById('confirm-delete');
        const placeForm = document.getElementById('place-form');
        
        // Add buttons
        const addRestaurantBtn = document.getElementById('add-restaurant-btn');
        const addCafeBtn = document.getElementById('add-cafe-btn');
        const addBeachBtn = document.getElementById('add-beach-btn');
        const addDiscoBtn = document.getElementById('add-disco-btn');
        
        // Table bodies
        const restaurantsTable = document.getElementById('restaurants-table');
        const cafesTable = document.getElementById('cafes-table');
        const beachesTable = document.getElementById('beaches-table');
        const discosTable = document.getElementById('discos-table');
        
        // Dashboard elements
        const restaurantsCount = document.getElementById('restaurants-count');
        const cafesCount = document.getElementById('cafes-count');
        const beachesCount = document.getElementById('beaches-count');
        const discosCount = document.getElementById('discos-count');
        const activityTable = document.getElementById('activity-table');
        
        // Form elements
        const modalTitle = document.getElementById('modal-title');
        const placeIdInput = document.getElementById('place-id');
        const placeTypeInput = document.getElementById('place-type');
        const nameInput = document.getElementById('name');
        const typeSelect = document.getElementById('type');
        const areaSelect = document.getElementById('area');
        const ratingInput = document.getElementById('rating');
        const reviewsInput = document.getElementById('reviews');
        const phoneInput = document.getElementById('phone');
        const hoursInput = document.getElementById('hours');
        const featuresInput = document.getElementById('features');
        const menuLinkInput = document.getElementById('menu-link');
        const ticketLinkInput = document.getElementById('ticket-link');
        const descriptionInput = document.getElementById('description');
        const latitudeInput = document.getElementById('latitude');
        const longitudeInput = document.getElementById('longitude');
        const mainImageInput = document.getElementById('main-image');
        const logoImageInput = document.getElementById('logo-image');
        const mainImagePreview = document.getElementById('main-image-preview');
        const logoImagePreview = document.getElementById('logo-image-preview');
        const mainImagePreviewContainer = document.getElementById('main-image-preview-container');
        const logoImagePreviewContainer = document.getElementById('logo-image-preview-container');
        
        // Map elements
        const locationMapElement = document.getElementById('location-map');
        let locationMap = null;
        let locationMarker = null;
        
        // State variables
        let currentPlaceToDelete = null;
        let mainImageFile = null;
        let logoImageFile = null;
        
        // Initialize the admin panel
        initAdminPanel();
        
        function initAdminPanel() {
            // Toggle sidebar
            sidebarToggle.addEventListener('click', (e) => {
                e.preventDefault();
                adminContainer.classList.toggle('sharm-admin-collapsed');
                
                // Change the icon based on state
                const icon = sidebarToggle.querySelector('i');
                if (adminContainer.classList.contains('sharm-admin-collapsed')) {
                    icon.classList.remove('fa-bars');
                    icon.classList.add('fa-chevron-right');
                } else {
                    icon.classList.remove('fa-chevron-right');
                    icon.classList.add('fa-bars');
                }
            });
            
            // Navigation tabs
            navItems.forEach(item => {
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    const tab = item.getAttribute('data-tab');
                    
                    // Update active nav item
                    navItems.forEach(navItem => {
                        navItem.classList.remove('active');
                        navItem.querySelector('i').classList.remove('text-amber-400');
                        navItem.querySelector('i').classList.add('text-gray-400');
                    });
                    
                    item.classList.add('active');
                    item.querySelector('i').classList.remove('text-gray-400');
                    item.querySelector('i').classList.add('text-amber-400');
                    
                    // Show corresponding tab
                    tabContents.forEach(content => content.classList.remove('active'));
                    document.getElementById(`${tab}-tab`).classList.add('active');
                });
            });
            
            // Modal controls
            closeModalBtn.addEventListener('click', closeModal);
            closeConfirmModalBtn.addEventListener('click', closeConfirmModal);
            cancelModalBtn.addEventListener('click', closeModal);
            cancelDeleteBtn.addEventListener('click', closeConfirmModal);
            
            // Add buttons
            addRestaurantBtn.addEventListener('click', () => openAddModal('restaurants'));
            addCafeBtn.addEventListener('click', () => openAddModal('cafes'));
            addBeachBtn.addEventListener('click', () => openAddModal('beaches'));
            addDiscoBtn.addEventListener('click', () => openAddModal('discos'));
            
            // Form submission
            placeForm.addEventListener('submit', handleFormSubmit);
            
            // Confirm delete
            confirmDeleteBtn.addEventListener('click', confirmDelete);
            
            // Image upload previews
            mainImageInput.addEventListener('change', (e) => handleImageUpload(e, mainImagePreview, mainImagePreviewContainer));
            logoImageInput.addEventListener('change', (e) => handleImageUpload(e, logoImagePreview, logoImagePreviewContainer));
            
            // Load initial data
            loadCounts();
            loadActivityLogs();
            loadRestaurants();
            loadCafes();
            loadBeaches();
            loadDiscos();
        }
        
        // Load counts for dashboard
        async function loadCounts() {
            try {
                const restaurantsSnapshot = await db.collection('restaurants').get();
                const cafesSnapshot = await db.collection('cafes').get();
                const beachesSnapshot = await db.collection('beaches').get();
                const discosSnapshot = await db.collection('discos').get();
                
                restaurantsCount.textContent = restaurantsSnapshot.size;
                cafesCount.textContent = cafesSnapshot.size;
                beachesCount.textContent = beachesSnapshot.size;
                discosCount.textContent = discosSnapshot.size;
            } catch (error) {
                console.error("Error loading counts:", error);
            }
        }
        
        // Load activity logs
        async function loadActivityLogs() {
            try {
                const snapshot = await db.collection('activity')
                    .orderBy('timestamp', 'desc')
                    .limit(10)
                    .get();
                
                activityTable.innerHTML = '';
                
                snapshot.forEach(doc => {
                    const data = doc.data();
                    const row = document.createElement('tr');
                    
                    row.innerHTML = `
                        <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-300">${data.type}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-400">${data.name}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-400">${data.action}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-400">${new Date(data.timestamp).toLocaleString()}</td>
                    `;
                    
                    activityTable.appendChild(row);
                });
            } catch (error) {
                console.error("Error loading activity logs:", error);
            }
        }
        
        // Load restaurants
        async function loadRestaurants() {
            try {
                const snapshot = await db.collection('restaurants')
                    .orderBy('rating', 'desc')
                    .get();
                
                restaurantsTable.innerHTML = '';
                
                snapshot.forEach(doc => {
                    const data = doc.data();
                    addPlaceToTable(doc.id, data, restaurantsTable, 'restaurants');
                });
            } catch (error) {
                console.error("Error loading restaurants:", error);
            }
        }
        
        // Load cafes
        async function loadCafes() {
            try {
                const snapshot = await db.collection('cafes')
                    .orderBy('rating', 'desc')
                    .get();
                
                cafesTable.innerHTML = '';
                
                snapshot.forEach(doc => {
                    const data = doc.data();
                    addPlaceToTable(doc.id, data, cafesTable, 'cafes');
                });
            } catch (error) {
                console.error("Error loading cafes:", error);
            }
        }
        
        // Load beaches
        async function loadBeaches() {
            try {
                const snapshot = await db.collection('beaches')
                    .orderBy('rating', 'desc')
                    .get();
                
                beachesTable.innerHTML = '';
                
                snapshot.forEach(doc => {
                    const data = doc.data();
                    addPlaceToTable(doc.id, data, beachesTable, 'beaches');
                });
            } catch (error) {
                console.error("Error loading beaches:", error);
            }
        }
        
        // Load discos
        async function loadDiscos() {
            try {
                const snapshot = await db.collection('discos')
                    .orderBy('rating', 'desc')
                    .get();
                
                discosTable.innerHTML = '';
                
                snapshot.forEach(doc => {
                    const data = doc.data();
                    addPlaceToTable(doc.id, data, discosTable, 'discos');
                });
            } catch (error) {
                console.error("Error loading discos:", error);
            }
        }
        
        // Add place to table
        function addPlaceToTable(id, data, table, type) {
            const row = document.createElement('tr');
            
            row.innerHTML = `
                <td class="px-4 py-3 whitespace-nowrap">
                    <div class="flex items-center">
                        <div class="flex-shrink-0 h-10 w-10">
                            <img class="h-10 w-10 rounded-full" src="${data.logo || 'https://via.placeholder.com/100'}" alt="${data.name}">
                        </div>
                        <div class="ml-4">
                            <div class="text-sm font-medium text-gray-300">${data.name}</div>
                            <div class="text-sm text-gray-400">${getAreaName(data.area)}</div>
                        </div>
                    </div>
                </td>
                <td class="px-4 py-3 whitespace-nowrap">
                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-amber-100 text-amber-800">
                        ${getTypeName(data.type)}
                    </span>
                </td>
                <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-400">
                    ${getAreaName(data.area)}
                </td>
                <td class="px-4 py-3 whitespace-nowrap">
                    <div class="flex items-center">
                        ${getStarRating(data.rating)}
                        <span class="ml-1 text-sm text-gray-400">(${data.reviews || 0})</span>
                    </div>
                </td>
                <td class="px-4 py-3 whitespace-nowrap text-right text-sm font-medium">
                    <button class="text-amber-500 hover:text-amber-600 mr-3 edit-btn" data-id="${id}" data-type="${type}">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="text-red-500 hover:text-red-600 delete-btn" data-id="${id}" data-type="${type}">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            `;
            
            table.appendChild(row);
            
            // Add event listeners to the new buttons
            row.querySelector('.edit-btn').addEventListener('click', (e) => {
                const id = e.target.closest('button').getAttribute('data-id');
                const type = e.target.closest('button').getAttribute('data-type');
                openEditModal(id, type);
            });
            
            row.querySelector('.delete-btn').addEventListener('click', (e) => {
                const id = e.target.closest('button').getAttribute('data-id');
                const type = e.target.closest('button').getAttribute('data-type');
                openConfirmModal(id, type);
            });
        }
        
        // Open add modal
        function openAddModal(type) {
            resetForm();
            placeTypeInput.value = type;
            modalTitle.textContent = `Add New ${getTypeDisplayName(type)}`;
            
            // Set up type dropdown based on category
            setupTypeDropdown(type);
            
            // Show/hide relevant fields based on type
            toggleFormFields(type);
            
            // Initialize map
            initMap(27.9158, 34.3299); // Default coordinates for Sharm El Sheikh
            
            // Show modal
            placeModal.classList.remove('hidden');
        }
        
        // Open edit modal
        async function openEditModal(id, type) {
            try {
                const doc = await db.collection(type).doc(id).get();
                if (!doc.exists) {
                    alert('Place not found!');
                    return;
                }
                
                const data = doc.data();
                
                // Fill form with data
                placeIdInput.value = id;
                placeTypeInput.value = type;
                modalTitle.textContent = `Edit ${data.name}`;
                nameInput.value = data.name;
                ratingInput.value = data.rating;
                reviewsInput.value = data.reviews || 0;
                descriptionInput.value = data.description;
                areaSelect.value = data.area;
                phoneInput.value = data.phone || '';
                
                // Set up type dropdown based on category
                setupTypeDropdown(type);
                typeSelect.value = data.type;
                
                // Set location coordinates
                latitudeInput.value = data.coordinates[0];
                longitudeInput.value = data.coordinates[1];
                
                // Set optional fields
                if (data.hours) hoursInput.value = data.hours;
                if (data.features) featuresInput.value = data.features;
                if (data.menuLink) menuLinkInput.value = data.menuLink;
                if (data.ticketLink) ticketLinkInput.value = data.ticketLink;
                
                // Show/hide relevant fields based on type
                toggleFormFields(type);
                
                // Set image previews if they exist
                if (data.image) {
                    mainImagePreview.src = data.image;
                    mainImagePreview.classList.remove('hidden');
                    mainImagePreviewContainer.classList.add('hidden');
                }
                
                if (data.logo) {
                    logoImagePreview.src = data.logo;
                    logoImagePreview.classList.remove('hidden');
                    logoImagePreviewContainer.classList.add('hidden');
                }
                
                // Initialize map with place location
                initMap(data.coordinates[0], data.coordinates[1]);
                
                // Show modal
                placeModal.classList.remove('hidden');
                
            } catch (error) {
                console.error("Error opening edit modal:", error);
                alert('Error loading place data');
            }
        }
        
        // Open confirm delete modal
        function openConfirmModal(id, type) {
            currentPlaceToDelete = { id, type };
            confirmModal.classList.remove('hidden');
        }
        
        // Close modal
        function closeModal() {
            placeModal.classList.add('hidden');
            resetForm();
        }
        
        // Close confirm modal
        function closeConfirmModal() {
            confirmModal.classList.add('hidden');
            currentPlaceToDelete = null;
        }
        
        // Reset form
        function resetForm() {
            placeForm.reset();
            placeIdInput.value = '';
            placeTypeInput.value = '';
            mainImageFile = null;
            logoImageFile = null;
            mainImagePreview.src = '';
            logoImagePreview.src = '';
            mainImagePreview.classList.add('hidden');
            logoImagePreview.classList.add('hidden');
            mainImagePreviewContainer.classList.remove('hidden');
            logoImagePreviewContainer.classList.remove('hidden');
            
            // Reset map if it exists
            if (locationMap) {
                locationMap.off();
                locationMap.remove();
                locationMap = null;
                locationMarker = null;
            }
        }
        
        // Initialize map
        function initMap(lat, lng) {
            if (locationMap) {
                locationMap.off();
                locationMap.remove();
            }
            
            locationMap = L.map('location-map').setView([lat, lng], 15);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: ''
            }).addTo(locationMap);
            
            // Add marker
            locationMarker = L.marker([lat, lng], { draggable: true }).addTo(locationMap)
                .bindPopup('Location')
                .openPopup();
            
            // Update coordinates when marker is dragged
            locationMarker.on('dragend', function(e) {
                const newLat = e.target.getLatLng().lat;
                const newLng = e.target.getLatLng().lng;
                latitudeInput.value = newLat;
                longitudeInput.value = newLng;
            });
            
            // Update coordinates when map is clicked
            locationMap.on('click', function(e) {
                const newLat = e.latlng.lat;
                const newLng = e.latlng.lng;
                
                latitudeInput.value = newLat;
                longitudeInput.value = newLng;
                
                if (locationMarker) {
                    locationMarker.setLatLng([newLat, newLng]);
                } else {
                    locationMarker = L.marker([newLat, newLng], { draggable: true }).addTo(locationMap)
                        .bindPopup('Location')
                        .openPopup();
                }
            });
        }
        
        // Setup type dropdown based on category
        function setupTypeDropdown(type) {
            typeSelect.innerHTML = '';
            
            const types = {
                restaurants: [
                    { value: 'seafood', label: 'Seafood' },
                    { value: 'egyptian', label: 'Egyptian' },
                    { value: 'italian', label: 'Italian' },
                    { value: 'international', label: 'International' },
                    { value: 'middle-eastern', label: 'Middle Eastern' }
                ],
                cafes: [
                    { value: 'specialty', label: 'Specialty Coffee' },
                    { value: 'breakfast', label: 'Breakfast Café' },
                    { value: 'dessert', label: 'Dessert Café' },
                    { value: 'coffee', label: 'Coffee Shop' },
                    { value: 'cafe', label: 'Café' }
                ],
                beaches: [
                    { value: 'public', label: 'Public Beach' },
                    { value: 'resort', label: 'Resort Beach' },
                    { value: 'private', label: 'Private Beach' }
                ],
                discos: [
                    { value: 'nightclub', label: 'Nightclub' },
                    { value: 'lounge', label: 'Lounge' },
                    { value: 'bar', label: 'Bar' }
                ]
            };
            
            types[type].forEach(item => {
                const option = document.createElement('option');
                option.value = item.value;
                option.textContent = item.label;
                typeSelect.appendChild(option);
            });
        }
        
        // Toggle form fields based on type
        function toggleFormFields(type) {
            // Hide all optional fields first
            document.getElementById('hours-container').classList.add('hidden');
            document.getElementById('features-container').classList.add('hidden');
            document.getElementById('menu-link-container').classList.add('hidden');
            document.getElementById('ticket-link-container').classList.add('hidden');
            
            // Show relevant fields based on type
            switch(type) {
                case 'restaurants':
                    document.getElementById('menu-link-container').classList.remove('hidden');
                    document.getElementById('hours-container').classList.remove('hidden');
                    break;
                case 'cafes':
                    document.getElementById('menu-link-container').classList.remove('hidden');
                    document.getElementById('hours-container').classList.remove('hidden');
                    break;
                case 'beaches':
                    document.getElementById('features-container').classList.remove('hidden');
                    document.getElementById('ticket-link-container').classList.remove('hidden');
                    break;
                case 'discos':
                    document.getElementById('hours-container').classList.remove('hidden');
                    break;
            }
        }
        
        // Handle form submission
        async function handleFormSubmit(e) {
            e.preventDefault();
            
            const id = placeIdInput.value;
            const type = placeTypeInput.value;
            const isEdit = !!id;
            
            try {
                // Basic validation
                if (!nameInput.value || !ratingInput.value || !descriptionInput.value || 
                    !latitudeInput.value || !longitudeInput.value) {
                    alert('Please fill in all required fields');
                    return;
                }
                
                // Prepare place data
                const placeData = {
                    name: nameInput.value,
                    type: typeSelect.value,
                    area: areaSelect.value,
                    rating: parseFloat(ratingInput.value),
                    reviews: parseInt(reviewsInput.value) || 0,
                    description: descriptionInput.value,
                    coordinates: [parseFloat(latitudeInput.value), parseFloat(longitudeInput.value)],
                    phone: phoneInput.value || '',
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                // Add optional fields based on type
                if (hoursInput.value && !document.getElementById('hours-container').classList.contains('hidden')) {
                    placeData.hours = hoursInput.value;
                }
                
                if (featuresInput.value && !document.getElementById('features-container').classList.contains('hidden')) {
                    placeData.features = featuresInput.value;
                }
                
                if (menuLinkInput.value && !document.getElementById('menu-link-container').classList.contains('hidden')) {
                    placeData.menuLink = menuLinkInput.value;
                }
                
                if (ticketLinkInput.value && !document.getElementById('ticket-link-container').classList.contains('hidden')) {
                    placeData.ticketLink = ticketLinkInput.value;
                }
                
                // Upload images if they were changed
                if (mainImageFile) {
                    const imageUrl = await uploadImage(mainImageFile, `places/${type}/${id || 'new'}/main`);
                    placeData.image = imageUrl;
                }
                
                if (logoImageFile) {
                    const logoUrl = await uploadImage(logoImageFile, `places/${type}/${id || 'new'}/logo`);
                    placeData.logo = logoUrl;
                }
                
                // Save to Firestore
                if (isEdit) {
                    await db.collection(type).doc(id).update(placeData);
                    logActivity(type, 'updated', placeData.name);
                } else {
                    placeData.createdAt = firebase.firestore.FieldValue.serverTimestamp();
                    await db.collection(type).add(placeData);
                    logActivity(type, 'added', placeData.name);
                }
                
                // Refresh data
                refreshData(type);
                
                // Close modal
                closeModal();
                
            } catch (error) {
                console.error("Error saving place:", error);
                alert('Error saving place. Please try again.');
            }
        }
        
        // Upload image to Firebase Storage
        async function uploadImage(file, path) {
            try {
                const storageRef = storage.ref(`${path}_${Date.now()}`);
                const snapshot = await storageRef.put(file);
                const downloadURL = await snapshot.ref.getDownloadURL();
                return downloadURL;
            } catch (error) {
                console.error("Error uploading image:", error);
                throw error;
            }
        }
        
        // Confirm delete
        async function confirmDelete() {
            if (!currentPlaceToDelete) return;
            
            try {
                const { id, type } = currentPlaceToDelete;
                
                // Get place name for activity log
                const doc = await db.collection(type).doc(id).get();
                const placeName = doc.data().name;
                
                // Delete document
                await db.collection(type).doc(id).delete();
                
                // Log activity
                logActivity(type, 'deleted', placeName);
                
                // Refresh data
                refreshData(type);
                
                // Close modal
                closeConfirmModal();
                
            } catch (error) {
                console.error("Error deleting place:", error);
                alert('Error deleting place. Please try again.');
            }
        }
        
        // Refresh data after changes
        function refreshData(type) {
            switch(type) {
                case 'restaurants':
                    loadRestaurants();
                    break;
                case 'cafes':
                    loadCafes();
                    break;
                case 'beaches':
                    loadBeaches();
                    break;
                case 'discos':
                    loadDiscos();
                    break;
            }
            
            // Refresh counts and activity logs
            loadCounts();
            loadActivityLogs();
        }
        
        // Log activity
        async function logActivity(type, action, name) {
            try {
                await db.collection('activity').add({
                    type: getTypeDisplayName(type),
                    action,
                    name,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
            } catch (error) {
                console.error("Error logging activity:", error);
            }
        }
        
        // Handle image upload preview
        function handleImageUpload(event, previewElement, previewContainer) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            
            reader.onload = function(e) {
                previewElement.src = e.target.result;
                previewElement.classList.remove('hidden');
                previewContainer.classList.add('hidden');
            };
            
            reader.readAsDataURL(file);
            
            // Store the file for upload
            if (previewElement.id === 'main-image-preview') {
                mainImageFile = file;
            } else {
                logoImageFile = file;
            }
        }
        
        // Helper functions
        function getTypeName(typeKey) {
            const types = {
                // Restaurants
                'seafood': 'Seafood',
                'egyptian': 'Egyptian',
                'italian': 'Italian',
                'international': 'International',
                'middle-eastern': 'Middle Eastern',
                // Cafes
                'specialty': 'Specialty Coffee',
                'breakfast': 'Breakfast Café',
                'dessert': 'Dessert Café',
                'coffee': 'Coffee Shop',
                'cafe': 'Café',
                // Beaches
                'public': 'Public Beach',
                'resort': 'Resort Beach',
                'private': 'Private Beach',
                // Nightlife
                'nightclub': 'Nightclub',
                'lounge': 'Lounge',
                'bar': 'Bar'
            };
            return types[typeKey] || typeKey;
        }
        
        function getTypeDisplayName(type) {
            const types = {
                'restaurants': 'Restaurant',
                'cafes': 'Coffee Shop',
                'beaches': 'Beach',
                'discos': 'Nightlife Venue'
            };
            return types[type] || type;
        }
        
        function getAreaName(areaKey) {
            const areas = {
                'naama': 'Naama Bay',
                'old-market': 'Old Market',
                'hadaba': 'El Hadaba',
                'soho': 'Soho Square',
                'ras-um-sid': 'Ras Um Sid',
                'sharks-bay': "Shark's Bay"
            };
            return areas[areaKey] || areaKey;
        }
        
        function getStarRating(rating) {
            const fullStars = Math.floor(rating);
            const hasHalfStar = rating % 1 >= 0.5;
            let stars = '';
            
            for (let i = 1; i <= 5; i++) {
                if (i <= fullStars) {
                    stars += '<i class="fas fa-star text-amber-400"></i>';
                } else if (i === fullStars + 1 && hasHalfStar) {
                    stars += '<i class="fas fa-star-half-alt text-amber-400"></i>';
                } else {
                    stars += '<i class="far fa-star text-amber-400"></i>';
                }
            }
            
            return stars;
        }
    });
    </script>
</body>
</html>
